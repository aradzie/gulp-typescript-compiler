/// <reference path="../d/typescript-1.7.d.ts" />
var _compiler = require('../compiler');
var _lang = require('../lang');
var TS_1_7_Adapter = (function () {
    function TS_1_7_Adapter(_ts) {
        this._ts = _ts;
    }
    TS_1_7_Adapter.prototype.options = function () {
        return [
            {
                name: 'charset',
                type: 'string',
            },
            {
                name: 'declaration',
                type: 'boolean',
            },
            {
                name: 'diagnostics',
                type: 'boolean',
            },
            {
                name: 'emitBOM',
                type: 'boolean'
            },
            {
                name: 'emitDecoratorMetadata',
                type: 'boolean',
                experimental: true,
            },
            {
                name: 'experimentalAsyncFunctions',
                type: 'boolean',
            },
            {
                name: 'experimentalDecorators',
                type: 'boolean',
            },
            {
                name: 'help',
                type: 'boolean',
            },
            {
                name: 'init',
                type: 'boolean',
            },
            {
                name: 'inlineSourceMap',
                type: 'boolean',
            },
            {
                name: 'inlineSources',
                type: 'boolean',
            },
            {
                name: 'isolatedModules',
                type: 'boolean',
            },
            {
                name: 'jsx',
                type: {
                    'preserve': 1 /* Preserve */,
                    'react': 2 /* React */,
                },
            },
            {
                name: 'listFiles',
                type: 'boolean',
            },
            {
                name: 'locale',
                type: 'string',
            },
            {
                name: 'mapRoot',
                type: 'string',
                isFilePath: true,
            },
            {
                name: 'module',
                type: {
                    'commonjs': 1 /* CommonJS */,
                    'amd': 2 /* AMD */,
                    'system': 4 /* System */,
                    'umd': 3 /* UMD */,
                    'es6': 5 /* ES6 */,
                },
            },
            {
                name: 'moduleResolution',
                type: {
                    'node': 2 /* NodeJs */,
                    'classic': 1 /* Classic */,
                },
            },
            {
                name: 'newLine',
                type: {
                    'crlf': 0 /* CarriageReturnLineFeed */,
                    'lf': 1 /* LineFeed */,
                },
            },
            {
                name: 'noEmit',
                type: 'boolean',
            },
            {
                name: 'noEmitHelpers',
                type: 'boolean',
            },
            {
                name: 'noEmitOnError',
                type: 'boolean',
            },
            {
                name: 'noImplicitAny',
                type: 'boolean',
            },
            {
                name: 'noLib',
                type: 'boolean',
            },
            {
                name: 'noResolve',
                type: 'boolean',
            },
            {
                name: 'outDir',
                type: 'string',
                isFilePath: true,
            },
            {
                name: 'outFile',
                type: 'string',
                isFilePath: true,
            },
            {
                name: 'preserveConstEnums',
                type: 'boolean',
            },
            {
                name: 'removeComments',
                type: 'boolean',
            },
            {
                name: 'rootDir',
                type: 'string',
                isFilePath: true,
            },
            {
                name: 'skipDefaultLibCheck',
                type: 'boolean',
            },
            {
                name: 'sourceMap',
                type: 'boolean',
            },
            {
                name: 'sourceRoot',
                type: 'string',
                isFilePath: true,
            },
            {
                name: 'suppressExcessPropertyErrors',
                type: 'boolean',
                experimental: true
            },
            {
                name: 'suppressImplicitAnyIndexErrors',
                type: 'boolean',
            },
            {
                name: 'stripInternal',
                type: 'boolean',
                experimental: true
            },
            {
                name: 'target',
                type: {
                    'es3': 0 /* ES3 */,
                    'es5': 1 /* ES5 */,
                    'es6': 2 /* ES6 */,
                },
            },
        ];
    };
    TS_1_7_Adapter.prototype.compile = function (options, fileNames, output) {
        var host = this._ts.createCompilerHost(options);
        var program = this._ts.createProgram(fileNames, options, host);
        var diagnostics = [].concat(program.getSyntacticDiagnostics(), program.getOptionsDiagnostics(), program.getGlobalDiagnostics(), program.getSemanticDiagnostics(), program.getDeclarationDiagnostics());
        if (diagnostics.length > 0) {
            this._reportDiagnostics(diagnostics, output);
        }
        else {
            var result = program.emit(undefined, write, undefined);
            if (result.diagnostics.length > 0) {
                this._reportDiagnostics(result.diagnostics, output);
            }
        }
        function write(fileName, data) {
            output.write(options.rootDir, fileName, data);
        }
    };
    TS_1_7_Adapter.prototype._reportDiagnostics = function (diagnostics, output) {
        for (var _i = 0; _i < diagnostics.length; _i++) {
            var diagnostic = diagnostics[_i];
            this._reportDiagnostic(diagnostic, output);
        }
    };
    TS_1_7_Adapter.prototype._reportDiagnostic = function (diagnostic, output) {
        var category = (_a = {},
            _a[this._ts.DiagnosticCategory.Warning] = _compiler.DiagnosticCategory.Warning,
            _a[this._ts.DiagnosticCategory.Error] = _compiler.DiagnosticCategory.Error,
            _a[this._ts.DiagnosticCategory.Message] = _compiler.DiagnosticCategory.Message,
            _a
        );
        var d = empty();
        if (diagnostic.file) {
            var p = this._ts.getLineAndCharacterOfPosition(diagnostic.file, diagnostic.start);
            d.fileName = diagnostic.file.fileName;
            d.start = diagnostic.start;
            d.length = diagnostic.length;
            d.line = p.line;
            d.character = p.character;
        }
        d.category = category[diagnostic.category];
        d.code = diagnostic.code;
        if (_lang.isString(diagnostic.messageText)) {
            d.message = diagnostic.messageText;
        }
        else {
            message(d, diagnostic.messageText);
        }
        output.diagnostics.push(d);
        function message(d, next) {
            d.message = next.messageText;
            next = next.next;
            while (next) {
                var t = empty();
                t.category = category[next.category];
                t.code = next.code;
                t.message = next.messageText;
                d.next = t;
                d = t;
                next = next.next;
            }
        }
        function empty() {
            return {
                fileName: null,
                start: null,
                length: null,
                line: null,
                character: null,
                category: null,
                code: null,
                message: null,
                next: null
            };
        }
        var _a;
    };
    TS_1_7_Adapter.VERSION = '~1.7.2';
    return TS_1_7_Adapter;
})();
module.exports = TS_1_7_Adapter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVFNfMV83LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVFNfMV83LnRzIl0sIm5hbWVzIjpbIlRTXzFfN19BZGFwdGVyIiwiVFNfMV83X0FkYXB0ZXIuY29uc3RydWN0b3IiLCJUU18xXzdfQWRhcHRlci5vcHRpb25zIiwiVFNfMV83X0FkYXB0ZXIuY29tcGlsZSIsIlRTXzFfN19BZGFwdGVyLmNvbXBpbGUud3JpdGUiLCJUU18xXzdfQWRhcHRlci5fcmVwb3J0RGlhZ25vc3RpY3MiLCJUU18xXzdfQWRhcHRlci5fcmVwb3J0RGlhZ25vc3RpYyIsIlRTXzFfN19BZGFwdGVyLl9yZXBvcnREaWFnbm9zdGljLm1lc3NhZ2UiLCJUU18xXzdfQWRhcHRlci5fcmVwb3J0RGlhZ25vc3RpYy5lbXB0eSJdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEO0FBR2pELElBQU8sU0FBUyxXQUFXLGFBQWEsQ0FBQyxDQUFDO0FBRTFDLElBQU8sS0FBSyxXQUFXLFNBQVMsQ0FBQyxDQUFDO0FBRWxDO0lBR0lBLHdCQUFvQkEsR0FBY0E7UUFBZEMsUUFBR0EsR0FBSEEsR0FBR0EsQ0FBV0E7SUFBR0EsQ0FBQ0E7SUFFdENELGdDQUFPQSxHQUFQQTtRQUNJRSxNQUFNQSxDQUFDQTtZQUNIQTtnQkFDSUEsSUFBSUEsRUFBRUEsU0FBU0E7Z0JBQ2ZBLElBQUlBLEVBQUVBLFFBQVFBO2FBQ2pCQTtZQUNEQTtnQkFDSUEsSUFBSUEsRUFBRUEsYUFBYUE7Z0JBQ25CQSxJQUFJQSxFQUFFQSxTQUFTQTthQUNsQkE7WUFDREE7Z0JBQ0lBLElBQUlBLEVBQUVBLGFBQWFBO2dCQUNuQkEsSUFBSUEsRUFBRUEsU0FBU0E7YUFDbEJBO1lBQ0RBO2dCQUNJQSxJQUFJQSxFQUFFQSxTQUFTQTtnQkFDZkEsSUFBSUEsRUFBRUEsU0FBU0E7YUFDbEJBO1lBQ0RBO2dCQUNJQSxJQUFJQSxFQUFFQSx1QkFBdUJBO2dCQUM3QkEsSUFBSUEsRUFBRUEsU0FBU0E7Z0JBQ2ZBLFlBQVlBLEVBQUVBLElB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QUNBLElBQUlBLENBQUNBO1lBQ2pCQSxPQUFPQSxJQUFJQSxFQUFFQSxDQUFDQTtnQkFDVkEsSUFBSUEsQ0FBQ0EsR0FBR0EsS0FBS0EsRUFBRUEsQ0FBQ0E7Z0JBQ2hCQSxDQUFDQSxDQUFDQSxRQUFRQSxHQUFHQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtnQkFDckNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO2dCQUNuQkEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQzdCQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDWEEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ05BLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1lBQ3JCQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVERDtZQUNJRSxNQUFNQSxDQUFDQTtnQkFDSEEsUUFBUUEsRUFBRUEsSUFBSUE7Z0JBQ2RBLEtBQUtBLEVBQUVBLElBQUlBO2dCQUNYQSxNQUFNQSxFQUFFQSxJQUFJQTtnQkFDWkEsSUFBSUEsRUFBRUEsSUFBSUE7Z0JBQ1ZBLFNBQVNBLEVBQUVBLElBQUlBO2dCQUNmQSxRQUFRQSxFQUFFQSxJQUFJQTtnQkFDZEEsSUFBSUEsRUFBRUEsSUFBSUE7Z0JBQ1ZBLE9BQU9BLEVBQUVBLElBQUlBO2dCQUNiQSxJQUFJQSxFQUFFQSxJQUFJQTthQUNiQSxDQUFDQTtRQUNOQSxDQUFDQTs7SUFDTEYsQ0FBQ0E7SUE1UU1OLHNCQUFPQSxHQUFHQSxRQUFRQSxDQUFDQTtJQTZROUJBLHFCQUFDQTtBQUFEQSxDQUFDQSxBQTlRRCxJQThRQztBQUVELGlCQUFTLGNBQWMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9kL3R5cGVzY3JpcHQtMS43LmQudHNcIiAvPlxuXG5pbXBvcnQgdHMgPSBUU18xXzc7XG5pbXBvcnQgX2NvbXBpbGVyID0gcmVxdWlyZSgnLi4vY29tcGlsZXInKTtcbmltcG9ydCBfdXRpbCA9IHJlcXVpcmUoJy4uL3V0aWwnKTtcbmltcG9ydCBfbGFuZyA9IHJlcXVpcmUoJy4uL2xhbmcnKTtcblxuY2xhc3MgVFNfMV83X0FkYXB0ZXIgaW1wbGVtZW50cyBfY29tcGlsZXIuQ29tcGlsZXIge1xuICAgIHN0YXRpYyBWRVJTSU9OID0gJ34xLjcuMic7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF90czogdHlwZW9mIHRzKSB7fVxuXG4gICAgb3B0aW9ucygpOiBfY29tcGlsZXIuT3B0aW9uW10ge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdjaGFyc2V0JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2RlY2xhcmF0aW9uJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdkaWFnbm9zdGljcycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZW1pdEJPTScsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdlbWl0RGVjb3JhdG9yTWV0YWRhdGEnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgICAgICBleHBlcmltZW50YWw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdleHBlcmltZW50YWxBc3luY0Z1bmN0aW9ucycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZXhwZXJpbWVudGFsRGVjb3JhdG9ycycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnaGVscCcsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW5pdCcsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW5saW5lU291cmNlTWFwJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdpbmxpbmVTb3VyY2VzJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdpc29sYXRlZE1vZHVsZXMnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2pzeCcsXG4gICAgICAgICAgICAgICAgdHlwZToge1xuICAgICAgICAgICAgICAgICAgICAncHJlc2VydmUnOiB0aGlzLl90cy5Kc3hFbWl0LlByZXNlcnZlLFxuICAgICAgICAgICAgICAgICAgICAncmVhY3QnOiB0aGlzLl90cy5Kc3hFbWl0LlJlYWN0LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdsaXN0RmlsZXMnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2xvY2FsZScsXG4gICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdtYXBSb290JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICBpc0ZpbGVQYXRoOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbW9kdWxlJyxcbiAgICAgICAgICAgICAgICB0eXBlOiB7XG4gICAgICAgICAgICAgICAgICAgICdjb21tb25qcyc6IHRoaXMuX3RzLk1vZHVsZUtpbmQuQ29tbW9uSlMsXG4gICAgICAgICAgICAgICAgICAgICdhbWQnOiB0aGlzLl90cy5Nb2R1bGVLaW5kLkFNRCxcbiAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbSc6IHRoaXMuX3RzLk1vZHVsZUtpbmQuU3lzdGVtLFxuICAgICAgICAgICAgICAgICAgICAndW1kJzogdGhpcy5fdHMuTW9kdWxlS2luZC5VTUQsXG4gICAgICAgICAgICAgICAgICAgICdlczYnOiB0aGlzLl90cy5Nb2R1bGVLaW5kLkVTNixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbW9kdWxlUmVzb2x1dGlvbicsXG4gICAgICAgICAgICAgICAgdHlwZToge1xuICAgICAgICAgICAgICAgICAgICAnbm9kZSc6IHRoaXMuX3RzLk1vZHVsZVJlc29sdXRpb25LaW5kLk5vZGVKcyxcbiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzaWMnOiB0aGlzLl90cy5Nb2R1bGVSZXNvbHV0aW9uS2luZC5DbGFzc2ljLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICduZXdMaW5lJyxcbiAgICAgICAgICAgICAgICB0eXBlOiB7XG4gICAgICAgICAgICAgICAgICAgICdjcmxmJzogdGhpcy5fdHMuTmV3TGluZUtpbmQuQ2FycmlhZ2VSZXR1cm5MaW5lRmVlZCxcbiAgICAgICAgICAgICAgICAgICAgJ2xmJzogdGhpcy5fdHMuTmV3TGluZUtpbmQuTGluZUZlZWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ25vRW1pdCcsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9FbWl0SGVscGVycycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9FbWl0T25FcnJvcicsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9JbXBsaWNpdEFueScsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9MaWInLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ25vUmVzb2x2ZScsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnb3V0RGlyJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICBpc0ZpbGVQYXRoOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnb3V0RmlsZScsXG4gICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICAgICAgaXNGaWxlUGF0aDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3ByZXNlcnZlQ29uc3RFbnVtcycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncmVtb3ZlQ29tbWVudHMnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Jvb3REaXInLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgIGlzRmlsZVBhdGg6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdza2lwRGVmYXVsdExpYkNoZWNrJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzb3VyY2VNYXAnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3NvdXJjZVJvb3QnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgIGlzRmlsZVBhdGg6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzdXBwcmVzc0V4Y2Vzc1Byb3BlcnR5RXJyb3JzJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICAgICAgZXhwZXJpbWVudGFsOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzdXBwcmVzc0ltcGxpY2l0QW55SW5kZXhFcnJvcnMnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0cmlwSW50ZXJuYWwnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgICAgICBleHBlcmltZW50YWw6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3RhcmdldCcsXG4gICAgICAgICAgICAgICAgdHlwZToge1xuICAgICAgICAgICAgICAgICAgICAnZXMzJzogdGhpcy5fdHMuU2NyaXB0VGFyZ2V0LkVTMyxcbiAgICAgICAgICAgICAgICAgICAgJ2VzNSc6IHRoaXMuX3RzLlNjcmlwdFRhcmdldC5FUzUsXG4gICAgICAgICAgICAgICAgICAgICdlczYnOiB0aGlzLl90cy5TY3JpcHRUYXJnZXQuRVM2LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgIH1cblxuICAgIGNvbXBpbGUob3B0aW9uczogdHMuQ29tcGlsZXJPcHRpb25zLCBmaWxlTmFtZXM6IHN0cmluZ1tdLCBvdXRwdXQ6IF9jb21waWxlci5PdXRwdXQpIHtcbiAgICAgICAgbGV0IGhvc3QgPSB0aGlzLl90cy5jcmVhdGVDb21waWxlckhvc3Qob3B0aW9ucyk7XG4gICAgICAgIGxldCBwcm9ncmFtID0gdGhpcy5fdHMuY3JlYXRlUHJvZ3JhbShmaWxlTmFtZXMsIG9wdGlvbnMsIGhvc3QpO1xuICAgICAgICBsZXQgZGlhZ25vc3RpY3MgPSBbXS5jb25jYXQoXG4gICAgICAgICAgICBwcm9ncmFtLmdldFN5bnRhY3RpY0RpYWdub3N0aWNzKCksXG4gICAgICAgICAgICBwcm9ncmFtLmdldE9wdGlvbnNEaWFnbm9zdGljcygpLFxuICAgICAgICAgICAgcHJvZ3JhbS5nZXRHbG9iYWxEaWFnbm9zdGljcygpLFxuICAgICAgICAgICAgcHJvZ3JhbS5nZXRTZW1hbnRpY0RpYWdub3N0aWNzKCksXG4gICAgICAgICAgICBwcm9ncmFtLmdldERlY2xhcmF0aW9uRGlhZ25vc3RpY3MoKVxuICAgICAgICApO1xuICAgICAgICBpZiAoZGlhZ25vc3RpY3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5fcmVwb3J0RGlhZ25vc3RpY3MoZGlhZ25vc3RpY3MsIG91dHB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gcHJvZ3JhbS5lbWl0KHVuZGVmaW5lZCwgd3JpdGUsIHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmRpYWdub3N0aWNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXBvcnREaWFnbm9zdGljcyhyZXN1bHQuZGlhZ25vc3RpY3MsIG91dHB1dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB3cml0ZShmaWxlTmFtZTogc3RyaW5nLCBkYXRhOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIG91dHB1dC53cml0ZShvcHRpb25zLnJvb3REaXIsIGZpbGVOYW1lLCBkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3JlcG9ydERpYWdub3N0aWNzKGRpYWdub3N0aWNzOiB0cy5EaWFnbm9zdGljW10sIG91dHB1dDogX2NvbXBpbGVyLk91dHB1dCkge1xuICAgICAgICBmb3IgKGxldCBkaWFnbm9zdGljIG9mIGRpYWdub3N0aWNzKSB7XG4gICAgICAgICAgICB0aGlzLl9yZXBvcnREaWFnbm9zdGljKGRpYWdub3N0aWMsIG91dHB1dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZXBvcnREaWFnbm9zdGljKGRpYWdub3N0aWM6IHRzLkRpYWdub3N0aWMsIG91dHB1dDogX2NvbXBpbGVyLk91dHB1dCkge1xuICAgICAgICBsZXQgY2F0ZWdvcnkgPSB7XG4gICAgICAgICAgICBbdGhpcy5fdHMuRGlhZ25vc3RpY0NhdGVnb3J5Lldhcm5pbmddOiBfY29tcGlsZXIuRGlhZ25vc3RpY0NhdGVnb3J5Lldhcm5pbmcsXG4gICAgICAgICAgICBbdGhpcy5fdHMuRGlhZ25vc3RpY0NhdGVnb3J5LkVycm9yXTogX2NvbXBpbGVyLkRpYWdub3N0aWNDYXRlZ29yeS5FcnJvcixcbiAgICAgICAgICAgIFt0aGlzLl90cy5EaWFnbm9zdGljQ2F0ZWdvcnkuTWVzc2FnZV06IF9jb21waWxlci5EaWFnbm9zdGljQ2F0ZWdvcnkuTWVzc2FnZSxcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IGQgPSBlbXB0eSgpO1xuICAgICAgICBpZiAoZGlhZ25vc3RpYy5maWxlKSB7XG4gICAgICAgICAgICBsZXQgcCA9IHRoaXMuX3RzLmdldExpbmVBbmRDaGFyYWN0ZXJPZlBvc2l0aW9uKGRpYWdub3N0aWMuZmlsZSwgZGlhZ25vc3RpYy5zdGFydCk7XG4gICAgICAgICAgICBkLmZpbGVOYW1lID0gZGlhZ25vc3RpYy5maWxlLmZpbGVOYW1lO1xuICAgICAgICAgICAgZC5zdGFydCA9IGRpYWdub3N0aWMuc3RhcnQ7XG4gICAgICAgICAgICBkLmxlbmd0aCA9IGRpYWdub3N0aWMubGVuZ3RoO1xuICAgICAgICAgICAgZC5saW5lID0gcC5saW5lO1xuICAgICAgICAgICAgZC5jaGFyYWN0ZXIgPSBwLmNoYXJhY3RlcjtcbiAgICAgICAgfVxuICAgICAgICBkLmNhdGVnb3J5ID0gY2F0ZWdvcnlbZGlhZ25vc3RpYy5jYXRlZ29yeV07XG4gICAgICAgIGQuY29kZSA9IGRpYWdub3N0aWMuY29kZTtcbiAgICAgICAgaWYgKF9sYW5nLmlzU3RyaW5nKGRpYWdub3N0aWMubWVzc2FnZVRleHQpKSB7XG4gICAgICAgICAgICBkLm1lc3NhZ2UgPSA8c3RyaW5nPmRpYWdub3N0aWMubWVzc2FnZVRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtZXNzYWdlKGQsIDx0cy5EaWFnbm9zdGljTWVzc2FnZUNoYWluPmRpYWdub3N0aWMubWVzc2FnZVRleHQpO1xuXG4gICAgICAgIH1cbiAgICAgICAgb3V0cHV0LmRpYWdub3N0aWNzLnB1c2goZCk7XG5cbiAgICAgICAgZnVuY3Rpb24gbWVzc2FnZShkOiBfY29tcGlsZXIuRGlhZ25vc3RpYywgbmV4dDogdHMuRGlhZ25vc3RpY01lc3NhZ2VDaGFpbikge1xuICAgICAgICAgICAgZC5tZXNzYWdlID0gbmV4dC5tZXNzYWdlVGV4dDtcbiAgICAgICAgICAgIG5leHQgPSBuZXh0Lm5leHQ7XG4gICAgICAgICAgICB3aGlsZSAobmV4dCkge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gZW1wdHkoKTtcbiAgICAgICAgICAgICAgICB0LmNhdGVnb3J5ID0gY2F0ZWdvcnlbbmV4dC5jYXRlZ29yeV07XG4gICAgICAgICAgICAgICAgdC5jb2RlID0gbmV4dC5jb2RlO1xuICAgICAgICAgICAgICAgIHQubWVzc2FnZSA9IG5leHQubWVzc2FnZVRleHQ7XG4gICAgICAgICAgICAgICAgZC5uZXh0ID0gdDtcbiAgICAgICAgICAgICAgICBkID0gdDtcbiAgICAgICAgICAgICAgICBuZXh0ID0gbmV4dC5uZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZW1wdHkoKTogX2NvbXBpbGVyLkRpYWdub3N0aWMge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmaWxlTmFtZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzdGFydDogbnVsbCxcbiAgICAgICAgICAgICAgICBsZW5ndGg6IG51bGwsXG4gICAgICAgICAgICAgICAgbGluZTogbnVsbCxcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6IG51bGwsXG4gICAgICAgICAgICAgICAgY29kZTogbnVsbCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIG5leHQ6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCA9IFRTXzFfN19BZGFwdGVyO1xuIl19