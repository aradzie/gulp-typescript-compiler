/// <reference path="../d/typescript-1.6.d.ts" />
var _compiler = require('../compiler');
var _lang = require('../lang');
var TS_1_6_Adapter = (function () {
    function TS_1_6_Adapter(_ts) {
        this._ts = _ts;
    }
    TS_1_6_Adapter.prototype.compile = function (options, fileNames, result) {
        var parseConfigResult = this._ts.parseConfigFile({
            'compilerOptions': options,
            'files': fileNames
        }, null, process.cwd());
        if (parseConfigResult.errors.length > 0) {
            this._reportDiagnostics(parseConfigResult.errors, result);
        }
        else {
            this._compileImpl(parseConfigResult.options, parseConfigResult.fileNames, result);
        }
    };
    TS_1_6_Adapter.prototype._compileImpl = function (options, fileNames, result) {
        var host = this._ts.createCompilerHost(options);
        var program = this._ts.createProgram(fileNames, options, new CompilerHost(host));
        this._reportDiagnostics(program.getOptionsDiagnostics(), result);
        this._reportDiagnostics(program.getGlobalDiagnostics(), result);
        this._reportDiagnostics(program.getSyntacticDiagnostics(), result);
        this._reportDiagnostics(program.getSemanticDiagnostics(), result);
        this._reportDiagnostics(program.getDeclarationDiagnostics(), result);
        var emitResult = program.emit(undefined, write, undefined);
        result.emitSkipped = emitResult.emitSkipped;
        this._reportDiagnostics(emitResult.diagnostics, result);
        function write(fileName, data) {
            result._create(options.rootDir, fileName, data);
        }
    };
    TS_1_6_Adapter.prototype._reportDiagnostics = function (diagnostics, result) {
        for (var _i = 0; _i < diagnostics.length; _i++) {
            var diagnostic = diagnostics[_i];
            this._reportDiagnostic(diagnostic, result);
        }
    };
    TS_1_6_Adapter.prototype._reportDiagnostic = function (diagnostic, result) {
        var category = (_a = {},
            _a[this._ts.DiagnosticCategory.Warning] = _compiler.DiagnosticCategory.Warning,
            _a[this._ts.DiagnosticCategory.Error] = _compiler.DiagnosticCategory.Error,
            _a[this._ts.DiagnosticCategory.Message] = _compiler.DiagnosticCategory.Message,
            _a
        );
        var d = empty();
        if (diagnostic.file) {
            var p = this._ts.getLineAndCharacterOfPosition(diagnostic.file, diagnostic.start);
            d.fileName = diagnostic.file.fileName;
            d.start = diagnostic.start;
            d.length = diagnostic.length;
            d.line = p.line;
            d.character = p.character;
        }
        d.category = category[diagnostic.category];
        d.code = diagnostic.code;
        if (_lang.isString(diagnostic.messageText)) {
            d.message = diagnostic.messageText;
        }
        else {
            message(d, diagnostic.messageText);
        }
        result.diagnostics.push(d);
        function message(d, next) {
            d.message = next.messageText;
            next = next.next;
            while (next) {
                var t = empty();
                t.category = category[next.category];
                t.code = next.code;
                t.message = next.messageText;
                d.next = t;
                d = t;
                next = next.next;
            }
        }
        function empty() {
            return {
                fileName: null,
                start: null,
                length: null,
                line: null,
                character: null,
                category: null,
                code: null,
                message: null,
                next: null
            };
        }
        var _a;
    };
    TS_1_6_Adapter.VERSION = '~1.6.2';
    return TS_1_6_Adapter;
})();
var CompilerHost = (function () {
    function CompilerHost(target) {
        this._target = target;
    }
    CompilerHost.prototype.writeFile = function (fileName, data, writeByteOrderMark, onError) {
        this._target.writeFile(fileName, data, writeByteOrderMark, onError);
    };
    CompilerHost.prototype.getSourceFile = function (fileName, languageVersion, onError) {
        return this._target.getSourceFile(fileName, languageVersion, onError);
    };
    CompilerHost.prototype.getDefaultLibFileName = function (options) {
        return this._target.getDefaultLibFileName(options);
    };
    CompilerHost.prototype.getCurrentDirectory = function () {
        return this._target.getCurrentDirectory();
    };
    CompilerHost.prototype.getCanonicalFileName = function (fileName) {
        return this._target.getCanonicalFileName(fileName);
    };
    CompilerHost.prototype.useCaseSensitiveFileNames = function () {
        return this._target.useCaseSensitiveFileNames();
    };
    CompilerHost.prototype.getNewLine = function () {
        return this._target.getNewLine();
    };
    CompilerHost.prototype.fileExists = function (fileName) {
        return this._target.fileExists(fileName);
    };
    CompilerHost.prototype.readFile = function (fileName) {
        return this._target.readFile(fileName);
    };
    return CompilerHost;
})();
module.exports = TS_1_6_Adapter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVFNfMV82LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVFNfMV82LnRzIl0sIm5hbWVzIjpbIlRTXzFfNl9BZGFwdGVyIiwiVFNfMV82X0FkYXB0ZXIuY29uc3RydWN0b3IiLCJUU18xXzZfQWRhcHRlci5jb21waWxlIiwiVFNfMV82X0FkYXB0ZXIuX2NvbXBpbGVJbXBsIiwiVFNfMV82X0FkYXB0ZXIuX2NvbXBpbGVJbXBsLndyaXRlIiwiVFNfMV82X0FkYXB0ZXIuX3JlcG9ydERpYWdub3N0aWNzIiwiVFNfMV82X0FkYXB0ZXIuX3JlcG9ydERpYWdub3N0aWMiLCJUU18xXzZfQWRhcHRlci5fcmVwb3J0RGlhZ25vc3RpYy5tZXNzYWdlIiwiVFNfMV82X0FkYXB0ZXIuX3JlcG9ydERpYWdub3N0aWMuZW1wdHkiLCJDb21waWxlckhvc3QiLCJDb21waWxlckhvc3QuY29uc3RydWN0b3IiLCJDb21waWxlckhvc3Qud3JpdGVGaWxlIiwiQ29tcGlsZXJIb3N0LmdldFNvdXJjZUZpbGUiLCJDb21waWxlckhvc3QuZ2V0RGVmYXVsdExpYkZpbGVOYW1lIiwiQ29tcGlsZXJIb3N0LmdldEN1cnJlbnREaXJlY3RvcnkiLCJDb21waWxlckhvc3QuZ2V0Q2Fub25pY2FsRmlsZU5hbWUiLCJDb21waWxlckhvc3QudXNlQ2FzZVNlbnNpdGl2ZUZpbGVOYW1lcyIsIkNvbXBpbGVySG9zdC5nZXROZXdMaW5lIiwiQ29tcGlsZXJIb3N0LmZpbGVFeGlzdHMiLCJDb21waWxlckhvc3QucmVhZEZpbGUiXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDtBQUdqRCxJQUFPLFNBQVMsV0FBVyxhQUFhLENBQUMsQ0FBQztBQUUxQyxJQUFPLEtBQUssV0FBVyxTQUFTLENBQUMsQ0FBQztBQUVsQztJQUdJQSx3QkFBb0JBLEdBQWNBO1FBQWRDLFFBQUdBLEdBQUhBLEdBQUdBLENBQVdBO0lBQUdBLENBQUNBO0lBRXRDRCxnQ0FBT0EsR0FBUEEsVUFBUUEsT0FBWUEsRUFBRUEsU0FB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QSxPQUEyQkE7UUFDN0NJLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLHFCQUFxQkEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7SUFDdkRBLENBQUNBO0lBRURKLDBDQUFtQkEsR0FBbkJBO1FBQ0lLLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7SUFDOUNBLENBQUNBO0lBRURMLDJDQUFvQkEsR0FBcEJBLFVBQXFCQSxRQUFnQkE7UUFDakNNLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLG9CQUFvQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDdkRBLENBQUNBO0lBRUROLGdEQUF5QkEsR0FBekJBO1FBQ0lPLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLHlCQUF5QkEsRUFBRUEsQ0FBQ0E7SUFDcERBLENBQUNBO0lBRURQLGlDQUFVQSxHQUFWQTtRQUNJUSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFVQSxFQUFFQSxDQUFDQTtJQUNyQ0EsQ0FBQ0E7SUFFRFIsaUNBQVVBLEdBQVZBLFVBQVdBLFFBQWdCQTtRQUN2QlMsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDN0NBLENBQUNBO0lBRURULCtCQUFRQSxHQUFSQSxVQUFTQSxRQUFnQkE7UUFDckJVLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBQzNDQSxDQUFDQTtJQUNMVixtQkFBQ0E7QUFBREEsQ0FBQ0EsQUExQ0QsSUEwQ0M7QUFFRCxpQkFBUyxjQUFjLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vZC90eXBlc2NyaXB0LTEuNi5kLnRzXCIgLz5cblxuaW1wb3J0IHRzID0gVFNfMV82O1xuaW1wb3J0IF9jb21waWxlciA9IHJlcXVpcmUoJy4uL2NvbXBpbGVyJyk7XG5pbXBvcnQgX3V0aWwgPSByZXF1aXJlKCcuLi91dGlsJyk7XG5pbXBvcnQgX2xhbmcgPSByZXF1aXJlKCcuLi9sYW5nJyk7XG5cbmNsYXNzIFRTXzFfNl9BZGFwdGVyIGltcGxlbWVudHMgX2NvbXBpbGVyLkNvbXBpbGVyIHtcbiAgICBzdGF0aWMgVkVSU0lPTiA9ICd+MS42LjInO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfdHM6IHR5cGVvZiB0cykge31cblxuICAgIGNvbXBpbGUob3B0aW9uczogYW55LCBmaWxlTmFtZXM6IHN0cmluZ1tdLCByZXN1bHQ6IF9jb21waWxlci5SZXN1bHQpIHtcbiAgICAgICAgbGV0IHBhcnNlQ29uZmlnUmVzdWx0ID0gdGhpcy5fdHMucGFyc2VDb25maWdGaWxlKHtcbiAgICAgICAgICAgICdjb21waWxlck9wdGlvbnMnOiBvcHRpb25zLFxuICAgICAgICAgICAgJ2ZpbGVzJzogZmlsZU5hbWVzXG4gICAgICAgIH0sIG51bGwsIHByb2Nlc3MuY3dkKCkpO1xuXG4gICAgICAgIGlmIChwYXJzZUNvbmZpZ1Jlc3VsdC5lcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5fcmVwb3J0RGlhZ25vc3RpY3MocGFyc2VDb25maWdSZXN1bHQuZXJyb3JzLCByZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY29tcGlsZUltcGwocGFyc2VDb25maWdSZXN1bHQub3B0aW9ucywgcGFyc2VDb25maWdSZXN1bHQuZmlsZU5hbWVzLCByZXN1bHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfY29tcGlsZUltcGwob3B0aW9uczogdHMuQ29tcGlsZXJPcHRpb25zLCBmaWxlTmFtZXM6IHN0cmluZ1tdLCByZXN1bHQ6IF9jb21waWxlci5SZXN1bHQpIHtcbiAgICAgICAgbGV0IGhvc3QgPSB0aGlzLl90cy5jcmVhdGVDb21waWxlckhvc3Qob3B0aW9ucyk7XG4gICAgICAgIGxldCBwcm9ncmFtID0gdGhpcy5fdHMuY3JlYXRlUHJvZ3JhbShmaWxlTmFtZXMsIG9wdGlvbnMsIG5ldyBDb21waWxlckhvc3QoaG9zdCkpO1xuICAgICAgICB0aGlzLl9yZXBvcnREaWFnbm9zdGljcyhwcm9ncmFtLmdldE9wdGlvbnNEaWFnbm9zdGljcygpLCByZXN1bHQpO1xuICAgICAgICB0aGlzLl9yZXBvcnREaWFnbm9zdGljcyhwcm9ncmFtLmdldEdsb2JhbERpYWdub3N0aWNzKCksIHJlc3VsdCk7XG4gICAgICAgIHRoaXMuX3JlcG9ydERpYWdub3N0aWNzKHByb2dyYW0uZ2V0U3ludGFjdGljRGlhZ25vc3RpY3MoKSwgcmVzdWx0KTtcbiAgICAgICAgdGhpcy5fcmVwb3J0RGlhZ25vc3RpY3MocHJvZ3JhbS5nZXRTZW1hbnRpY0RpYWdub3N0aWNzKCksIHJlc3VsdCk7XG4gICAgICAgIHRoaXMuX3JlcG9ydERpYWdub3N0aWNzKHByb2dyYW0uZ2V0RGVjbGFyYXRpb25EaWFnbm9zdGljcygpLCByZXN1bHQpO1xuICAgICAgICBsZXQgZW1pdFJlc3VsdCA9IHByb2dyYW0uZW1pdCh1bmRlZmluZWQsIHdyaXRlLCB1bmRlZmluZWQpO1xuICAgICAgICByZXN1bHQuZW1pdFNraXBwZWQgPSBlbWl0UmVzdWx0LmVtaXRTa2lwcGVkO1xuICAgICAgICB0aGlzLl9yZXBvcnREaWFnbm9zdGljcyhlbWl0UmVzdWx0LmRpYWdub3N0aWNzLCByZXN1bHQpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHdyaXRlKGZpbGVOYW1lOiBzdHJpbmcsIGRhdGE6IHN0cmluZykge1xuICAgICAgICAgICAgcmVzdWx0Ll9jcmVhdGUob3B0aW9ucy5yb290RGlyLCBmaWxlTmFtZSwgZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZXBvcnREaWFnbm9zdGljcyhkaWFnbm9zdGljczogdHMuRGlhZ25vc3RpY1tdLCByZXN1bHQ6IF9jb21waWxlci5SZXN1bHQpIHtcbiAgICAgICAgZm9yIChsZXQgZGlhZ25vc3RpYyBvZiBkaWFnbm9zdGljcykge1xuICAgICAgICAgICAgdGhpcy5fcmVwb3J0RGlhZ25vc3RpYyhkaWFnbm9zdGljLCByZXN1bHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcmVwb3J0RGlhZ25vc3RpYyhkaWFnbm9zdGljOiB0cy5EaWFnbm9zdGljLCByZXN1bHQ6IF9jb21waWxlci5SZXN1bHQpIHtcbiAgICAgICAgbGV0IGNhdGVnb3J5ID0ge1xuICAgICAgICAgICAgW3RoaXMuX3RzLkRpYWdub3N0aWNDYXRlZ29yeS5XYXJuaW5nXTogX2NvbXBpbGVyLkRpYWdub3N0aWNDYXRlZ29yeS5XYXJuaW5nLFxuICAgICAgICAgICAgW3RoaXMuX3RzLkRpYWdub3N0aWNDYXRlZ29yeS5FcnJvcl06IF9jb21waWxlci5EaWFnbm9zdGljQ2F0ZWdvcnkuRXJyb3IsXG4gICAgICAgICAgICBbdGhpcy5fdHMuRGlhZ25vc3RpY0NhdGVnb3J5Lk1lc3NhZ2VdOiBfY29tcGlsZXIuRGlhZ25vc3RpY0NhdGVnb3J5Lk1lc3NhZ2UsXG4gICAgICAgIH07XG4gICAgICAgIGxldCBkID0gZW1wdHkoKTtcbiAgICAgICAgaWYgKGRpYWdub3N0aWMuZmlsZSkge1xuICAgICAgICAgICAgbGV0IHAgPSB0aGlzLl90cy5nZXRMaW5lQW5kQ2hhcmFjdGVyT2ZQb3NpdGlvbihkaWFnbm9zdGljLmZpbGUsIGRpYWdub3N0aWMuc3RhcnQpO1xuICAgICAgICAgICAgZC5maWxlTmFtZSA9IGRpYWdub3N0aWMuZmlsZS5maWxlTmFtZTtcbiAgICAgICAgICAgIGQuc3RhcnQgPSBkaWFnbm9zdGljLnN0YXJ0O1xuICAgICAgICAgICAgZC5sZW5ndGggPSBkaWFnbm9zdGljLmxlbmd0aDtcbiAgICAgICAgICAgIGQubGluZSA9IHAubGluZTtcbiAgICAgICAgICAgIGQuY2hhcmFjdGVyID0gcC5jaGFyYWN0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZC5jYXRlZ29yeSA9IGNhdGVnb3J5W2RpYWdub3N0aWMuY2F0ZWdvcnldO1xuICAgICAgICBkLmNvZGUgPSBkaWFnbm9zdGljLmNvZGU7XG4gICAgICAgIGlmIChfbGFuZy5pc1N0cmluZyhkaWFnbm9zdGljLm1lc3NhZ2VUZXh0KSkge1xuICAgICAgICAgICAgZC5tZXNzYWdlID0gPHN0cmluZz5kaWFnbm9zdGljLm1lc3NhZ2VUZXh0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWVzc2FnZShkLCA8dHMuRGlhZ25vc3RpY01lc3NhZ2VDaGFpbj5kaWFnbm9zdGljLm1lc3NhZ2VUZXh0KTtcblxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5kaWFnbm9zdGljcy5wdXNoKGQpO1xuXG4gICAgICAgIGZ1bmN0aW9uIG1lc3NhZ2UoZDogX2NvbXBpbGVyLkRpYWdub3N0aWMsIG5leHQ6IHRzLkRpYWdub3N0aWNNZXNzYWdlQ2hhaW4pIHtcbiAgICAgICAgICAgIGQubWVzc2FnZSA9IG5leHQubWVzc2FnZVRleHQ7XG4gICAgICAgICAgICBuZXh0ID0gbmV4dC5uZXh0O1xuICAgICAgICAgICAgd2hpbGUgKG5leHQpIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IGVtcHR5KCk7XG4gICAgICAgICAgICAgICAgdC5jYXRlZ29yeSA9IGNhdGVnb3J5W25leHQuY2F0ZWdvcnldO1xuICAgICAgICAgICAgICAgIHQuY29kZSA9IG5leHQuY29kZTtcbiAgICAgICAgICAgICAgICB0Lm1lc3NhZ2UgPSBuZXh0Lm1lc3NhZ2VUZXh0O1xuICAgICAgICAgICAgICAgIGQubmV4dCA9IHQ7XG4gICAgICAgICAgICAgICAgZCA9IHQ7XG4gICAgICAgICAgICAgICAgbmV4dCA9IG5leHQubmV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGVtcHR5KCk6IF9jb21waWxlci5EaWFnbm9zdGljIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmlsZU5hbWU6IG51bGwsXG4gICAgICAgICAgICAgICAgc3RhcnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgbGVuZ3RoOiBudWxsLFxuICAgICAgICAgICAgICAgIGxpbmU6IG51bGwsXG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBudWxsLFxuICAgICAgICAgICAgICAgIGNvZGU6IG51bGwsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogbnVsbCxcbiAgICAgICAgICAgICAgICBuZXh0OiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBDb21waWxlckhvc3QgaW1wbGVtZW50cyB0cy5Db21waWxlckhvc3Qge1xuICAgIHByaXZhdGUgX3RhcmdldDogdHMuQ29tcGlsZXJIb3N0O1xuXG4gICAgY29uc3RydWN0b3IodGFyZ2V0OiB0cy5Db21waWxlckhvc3QpIHtcbiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdGFyZ2V0O1xuICAgIH1cblxuICAgIHdyaXRlRmlsZShmaWxlTmFtZTogc3RyaW5nLCBkYXRhOiBzdHJpbmcsIHdyaXRlQnl0ZU9yZGVyTWFyazogYm9vbGVhbiwgb25FcnJvcj86IChtZXNzYWdlOiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgICAgICAgdGhpcy5fdGFyZ2V0LndyaXRlRmlsZShmaWxlTmFtZSwgZGF0YSwgd3JpdGVCeXRlT3JkZXJNYXJrLCBvbkVycm9yKTtcbiAgICB9XG5cbiAgICBnZXRTb3VyY2VGaWxlKGZpbGVOYW1lOiBzdHJpbmcsIGxhbmd1YWdlVmVyc2lvbjogdHMuU2NyaXB0VGFyZ2V0LCBvbkVycm9yOiAobWVzc2FnZTogc3RyaW5nKSA9PiB2b2lkKTogdHMuU291cmNlRmlsZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQuZ2V0U291cmNlRmlsZShmaWxlTmFtZSwgbGFuZ3VhZ2VWZXJzaW9uLCBvbkVycm9yKTtcbiAgICB9XG5cbiAgICBnZXREZWZhdWx0TGliRmlsZU5hbWUob3B0aW9uczogdHMuQ29tcGlsZXJPcHRpb25zKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldC5nZXREZWZhdWx0TGliRmlsZU5hbWUob3B0aW9ucyk7XG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudERpcmVjdG9yeSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0LmdldEN1cnJlbnREaXJlY3RvcnkoKTtcbiAgICB9XG5cbiAgICBnZXRDYW5vbmljYWxGaWxlTmFtZShmaWxlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldC5nZXRDYW5vbmljYWxGaWxlTmFtZShmaWxlTmFtZSk7XG4gICAgfVxuXG4gICAgdXNlQ2FzZVNlbnNpdGl2ZUZpbGVOYW1lcygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldC51c2VDYXNlU2Vuc2l0aXZlRmlsZU5hbWVzKCk7XG4gICAgfVxuXG4gICAgZ2V0TmV3TGluZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0LmdldE5ld0xpbmUoKTtcbiAgICB9XG5cbiAgICBmaWxlRXhpc3RzKGZpbGVOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldC5maWxlRXhpc3RzKGZpbGVOYW1lKTtcbiAgICB9XG5cbiAgICByZWFkRmlsZShmaWxlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldC5yZWFkRmlsZShmaWxlTmFtZSk7XG4gICAgfVxufVxuXG5leHBvcnQgPSBUU18xXzZfQWRhcHRlcjtcbiJdfQ==